---
layout: post
title: hilo使用文档
authors:
  - name: 浩添
---


##下载安装

Hilo是一个开放式的框架，有多种模块化范式的版本可以使用，下载地址:

 - [Standalone 独立版本](http://hilo.alibaba-inc.com/download/hilo-standalone.zip?spm=0.0.0.0.PuqCI0&file=hilo-standalone.zip)
 - [For Kissy 版本](http://hilo.alibaba-inc.com/download/hilo-kissy.zip?spm=0.0.0.0.PuqCI0&file=hilo-kissy.zip)
 - [For RequireJS 版本](http://hilo.alibaba-inc.com/download/hilo-requirejs.zip?spm=0.0.0.0.PuqCI0&file=hilo-requirejs.zip)
 - [For CommonJS 版本](http://hilo.alibaba-inc.com/download/hilo-cmd.zip?spm=0.0.0.0.PuqCI0&file=hilo-cmd.zip)
 - [gitlab地址](http://gitlab.alibaba-inc.com/hilo/hilo)

##配置

```javascript
<script src="hilo-standalone.js"></script> //核心js
```
###创建舞台

- 舞台的概念
如果把整个游戏场景里面的元素都理解为一个有嵌套关系的节点的话。那么其实“舞台”就是一个虚拟的“根节点”的概念，后面所有的基于canvas绘制的元素都是作为“舞台”的子元素放到舞台里面的。
- 节点的概念
Hilo里面有“容器节点”和“视图节点”。容器节点就跟我们dom里面的 div 类似，可以无限嵌套。 视图节点 就相当于 一些特殊的 叶节点。不能再嵌套子元素，通常是 Bitmap，Text 等元素。
- 代码示例：

```javascript
var w = Math.min(640, window.innerWidth),
            h = window.innerHeight;
            w = window.devicePixelRatio > 1 ? w*2 : w;
            h = window.devicePixelRatio > 1 ? h*2 : h;
        Game.stage = new Hilo.Stage({
            canvas: document.getElementById('canvas'),//$('#canvas')[0]
            width: w,
            height: h,
            scaleX: (window.devicePixelRatio > 1 ? 0.5 : 1),//缩放比例适配Retina
            scaleY: (window.devicePixelRatio > 1 ? 0.5 : 1)
        });
```
###舞台重绘
使用canvas来完成动画或者游戏，其中一个很基本也很重要的概念就是重绘机制。可以理解为我们其实是需要一个计时器，以固定的频率，将我们的canvas画布擦掉，然后画上新的内容。以此来做到连贯动画的目的。

Hilo提供了默认的包装，Ticker机制，也就是我们新起一个ticker，然后把舞台加进去，那么这个ticker就会自动去完成舞台的“擦除”和“重绘”的工作。

- 代码示例

```javascript
Game.ticker = new Hilo.Ticker(60)  //1s中刷新60次
Game.ticker.addTick(Game.stage)
Game.ticker.start()
```
###向舞台添加、删除元素
游戏画面一般由大量的图形、精灵动画等组成。舞台作为一个容器，它同样提供了方便的方法来管理这些可视对象。如添加、删除、排序等。

- addChild - 添加子对象。
- removeChild - 删除子对象。
- setChildIndex - 设置子对象的Z轴顺序，即深度depth。
- sortChildren - 对象所有子对象进行排序。

- 代码示例

```javascript
//存放元素数据
Game.data = {
    bg: {
        url: './images/bg.png',
        width: 1066,
        height: 600
    }
};

//游戏背景
Game.bg = function () {
    // new 一个Bitmap实例
    var bm = new Hilo.Bitmap({
        image: Game.data.bg.url,
        rect: [0, 0, Game.data.bg.width, Game.data.bg.height], //位图在图像image中矩形区域,只有在chrome 360极速浏览器中支持负值
        x: 0,
        y:0
    });
    bm.y = Game.stage.height - bm.height;
    bm.x = (Game.stage.width - bm.width)/2;
    // 添加到舞台中
    Game.stage.addChild(bm);

    return bm;
}();
```
##事件交互

要想舞台上的图形、精灵动画等对象能响应用户的点击、触碰等交互事件，就必需先为舞台开启DOM事件响应，然后就可以使用View.on()来响应事件。
- 代码示例

```javascript
// 开启事件
// POINTER_START - 鼠标或触碰开始事件。对应touchstart或mousedown。
// POINTER_MOVE - 鼠标或触碰移动事件。对应touchmove或mousemove。
// POINTER_END - 鼠标或触碰结束事件。对应touchend或mouseup。
Game.stage.enableDOMEvent(Hilo.event.POINTER_START, true);
bm.on('mousedown', function(e){
    console.log(e.eventTarget, e.stageX, e.stageY);
}); //绑定事件
bm.off('mousedown', function(e){
    console.log(e.eventTarget, e.stageX, e.stageY);
}); //解绑事件
bm.fire('mousedown', function(e){
    console.log(e.eventTarget, e.stageX, e.stageY);
}); //触发事件
```

##资源预加载

在游戏开发中，会涉及到各种资源的预加载，比如图片素材、声音音效、各种数据等等。Hilo提供了一个简单的资源加载队列工具LoadQueue。

- 代码示例

```javascript
//初始化预加载队列
Game.queue = new Hilo.LoadQueue();
//存放所有图片等数据
Game.data = {
	imgList: [
		{id: 'role_1', src: './images/1.png'},
		{id: 'role_2', src: './images/2.png'},
		{id: 'bg', src: './images/bg.png'}
	]
}
Game.queue.add(Game.data.imgList);
Game.queue.on('complete', function (e) {
    Game.bg = new Game.Bg();
    Game.stage.addChild(Game.bg);
            
    Game.ticker = new Hilo.Ticker(60);
    Game.ticker.addTick(Game.stage);
    Game.ticker.start();

}).start();
```

##适配flash

```javascript
<script type="text/javascript" src="../build/standalone/hilo-standalone.js"></script>
<!-- flash adaptor -->
<script type="text/javascript" src="../build/flash/hilo-flash.min.js" data-auto="true"></script>
```
同时需要保证 在 hilo-flash.min.js 脚本所在目录下 有个Hilo提供的 swf 适配文件。[获取地址](http://gitlab.alibaba-inc.com/hilo/hilo/tree/master/build/flash)

##支持的舞台元素

###BitMap

- 代码示例

```javascript
function init(){
    var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winHeight - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });

    //start stage ticker
    var ticker = new Hilo.Ticker(20);
    ticker.addTick(stage);
    ticker.start();

    //create a bitmap
    var bmp = new Hilo.Bitmap({
        image: 'images/fish.png',
        rect: [0, 0, 174, 126],
        x: 75,
        y: 50
    }).addTo(stage);
}
```
- 效果演示
![BitMap](http://gtms03.alicdn.com/tps/i3/TB13mr0HXXXXXXmXVXXrGr14VXX-650-260.png)

###BitMapText

- 代码示例

```javascript
function init(){
    var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winHeight - gameContainer.offsetTop + 'px';

    var BitmapText = Hilo.BitmapText;
    var Stage = Hilo.Stage;
    var Container = Hilo.Container;
    var Ticker = Hilo.Ticker;

    //init stage
    var stage = new Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });

    //start stage ticker
    var ticker = new Ticker(20);
    ticker.addTick(stage);
    ticker.start();

    var container = new Container({
        x:winWidth * .5,
        y:0,
        background:"#aaa",
        width:400,
        height:400
    }).addTo(stage);

    var textImage = new Image();
    textImage.onload = function(){
        var bmp = new BitmapText({
            glyphs:BitmapText.createGlyphs("0123456789 ", textImage),
            y:0,
            x:0,
            textAlign:"center",
            letterSpacing:10
        }).setText("967542 2").addTo(container);
    };
    textImage.src = "./images/num.png";
    
}
```
- 效果演示
![BitMapText](http://gtms02.alicdn.com/tps/i2/TB1b0Y5HXXXXXb2XpXXvRlx8pXX-900-260.png)

###Button

- 代码示例

```javascript
function init(){
    var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winWidth - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });

    //start stage ticker
    var ticker = new Hilo.Ticker(20);
    ticker.addTick(stage);
    ticker.start();

    //enable dom events
    stage.enableDOMEvent([Hilo.event.POINTER_START, Hilo.event.POINTER_MOVE, Hilo.event.POINTER_END]);

    //blue button
    var blueBtn = new Hilo.Button({
        id: 'blueBtn',
        image: 'images/btn.png',
        width: 64,
        height: 64,
        upState: {rect:[0, 0, 64, 64]},
        overState: {rect:[64, 0, 64, 64]},
        downState: {rect:[128, 0, 64, 64]},
        disabledState: {rect:[192, 0, 64, 64]},
        x: 60,
        y: 50
    }).addTo(stage);

    //green button
    var greenBtn = new Hilo.Button({
        id: 'greenBtn',
        image: 'images/btn.png',
        width: 64,
        height: 64,
        upState: {rect:[0, 64, 64, 64]},
        overState: {rect:[64, 64, 64, 64]},
        downState: {rect:[128, 64, 64, 64]},
        disabledState: {rect:[192, 64, 64, 64]},
        x: 190,
        y: 50
    }).addTo(stage);

    //bind pointer events
    blueBtn.on(Hilo.event.POINTER_START, function(e){
        console.log(e.type, this);
    }).on(Hilo.event.POINTER_END, function(e){
        console.log(e.type, this);
    });

    greenBtn.on(Hilo.event.POINTER_START, function(e){
        console.log(e.type, this);
    }).on(Hilo.event.POINTER_END, function(e){
        console.log(e.type, this);
    });
}
```
- 效果演示

###DOMElement

- 代码示例

```javascript
function init(){
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = window.innerHeight - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer, 
        width: window.innerWidth,
        height: window.innerHeight - gameContainer.offsetTop
    });

    //start stage ticker
    var ticker = new Hilo.Ticker(60);
    ticker.addTick(stage);
    ticker.addTick(Hilo.Tween);
    ticker.start();

    //enable dom events
    stage.enableDOMEvent(Hilo.event.POINTER_START, true);

    //static bitmap
    var bmp = new Hilo.Bitmap({
        image: 'images/fish.png',
        rect: [0, 0, 174, 126],
        x: 75,
        y: 20
    }).addTo(stage);

    //dom element
    var blueRect = new Hilo.DOMElement({
        id: 'blueRect',
        element: Hilo.createElement('div', {
            style: {
                backgroundColor: '#004eff',
                position: 'absolute'
            }
        }),
        width: 100,
        height: 100,
        x: 50,
        y: 70
    }).addTo(stage);

    //dom element
    var yellowRect = new Hilo.DOMElement({
        id: 'yellowRect',
        element: Hilo.createElement('div', {
            style: {
                backgroundColor: '#ff0',
                position: 'absolute'
            }
        }),
        width: 100,
        height: 100,
        x: 80,
        y: 100
    }).addTo(stage);

    //dom element
    var redRect = new Hilo.DOMElement({
        id: 'redRect',
        element: Hilo.createElement('div', {
            style: {
                backgroundColor: '#f00',
                position: 'absolute',
            }
        }),
        width: 100,
        height: 100,
        x: 110,
        y: 130
    }).addTo(stage);

    //make redRect move
    Hilo.Tween.to(redRect, {x:220}, {time:500, loop:true, reverse:true});

    //bind events
    stage.on(Hilo.event.POINTER_START, function(e){
        if(e.eventTarget){
            console.log(e.eventTarget, e.stageX, e.stageY);
        }
    });
}
```
- 效果演示


###Drag

- 代码示例

```javascript
function init(){
    var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winHeight - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });

    stage.enableDOMEvent([Hilo.event.POINTER_START, Hilo.event.POINTER_MOVE, Hilo.event.POINTER_END]);

    //start stage ticker
    var ticker = new Hilo.Ticker(20);
    ticker.addTick(stage);
    ticker.start();

    var container = new Hilo.Container({
        x:winWidth * .1, 
        y:20, 
        width:winWidth * .8,
        height:200,
        background:"#f00"
    }).addTo(stage);

    //create a bitmap
    var bmp = new Hilo.Bitmap({
        image: 'images/fish.png',
        rect: [0, 0, 174, 126],
        x: container.x,
        y: container.y 
    }).addTo(stage);

    //mix drag
    Hilo.copy(bmp, Hilo.drag);
    bmp.startDrag([container.x, container.y, container.width - bmp.width, container.height - bmp.height]);
    
    bmp.on("dragStart", function(e){
        console.log("dragStart", e.detail.x, e.detail.y);
    });
    bmp.on("dragEnd", function(e){
        console.log("dragEnd", e.detail.x, e.detail.y);
    });
    bmp.on("dragMove", function(e){
        // console.log("dragMove", e.detail.x, e.detail.y);
    });

    document.ontouchstart = function(e){
        e.preventDefault();
    }
}
```
- 效果演示

###Graphics

- 代码示例

```javascript
function init(){
    var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winWidth - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });
    
    //start stage ticker
    var ticker = new Hilo.Ticker(20);
    ticker.addTick(stage);
    ticker.start();

    //rect
    var g1 = new Hilo.Graphics({width:100, height:100, x:40, y:20});
    g1.lineStyle(1, "#009898").beginFill("#0ff").drawRect(0.5, 0.5, 99, 99).endFill().addTo(stage);

    //round rect
    var g2 = new Hilo.Graphics({width:100, height:100, x:180, y:20});
    g2.lineStyle(10, "#009898").beginFill("#0ff").drawRoundRect(5, 5, 90, 90, 20).endFill().addTo(stage);

    //circle with radial gradient fill
    var g3 = new Hilo.Graphics({width:100, height:100, x:40, y:150});
    g3.lineStyle(2, "#009898").beginRadialGradientFill(50, 50, 0, 50, 50, 50, ["#fff", "#4ffcfc"], [0, 1]).drawCircle(2, 2, 48).endFill().addTo(stage);

    //ellipse
    var g4 = window.g4 = new Hilo.Graphics({width:100, height:60, x:180, y:170});
    g4.lineStyle(5, "#009898").beginFill("#0ff").drawEllipse(5, 5, 90, 50).endFill().addTo(stage);

    //rect with linear gradient
    var g5 = new Hilo.Graphics({width:70, height:90, x:55, y:290});
    g5.lineStyle(2, "#009898").beginLinearGradientFill(0, 0, 60, 0, ["#fff", "#4ffcfc"], [0.3, 1]).drawRect(2, 2, 66, 86).endFill().addTo(stage);

    //svg path
    var svgPath = "M53 84 C53 84 51 84 51 84 C51 89 53 94 56 94 C64 94 71 89 71 84 C71 72 64 64 56 64 C42 64 31 72 31 84 C31 100 42 114 56 114 C75 114 91 100 91 84 C91 61 75 44 56 44 C31 44 11 61 11 84 C11 111 31 134 56 134 C86 134 111 111 111 84 C111 50 86 24 56 24";
    var g6 = new Hilo.Graphics({width:120, height:150, x:170, y:250});
    g6.lineStyle(4, "#02d1d1").drawSVGPath(svgPath).closePath().endFill().addTo(stage);
}
```
- 效果演示
![BitMapText](http://gtms01.alicdn.com/tps/i1/TB1vAY4HXXXXXcEXpXXLjvH9XXX-660-450.png)

###Sprite

- 代码示例

```javascript
function init(){
    var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winWidth - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });

    //start stage ticker
    var ticker = new Hilo.Ticker(60);
    ticker.addTick(stage);
    ticker.start();

    //init texture atlas
    var atlas = new Hilo.TextureAtlas({
        image: 'images/fish.png',
        width: 174,
        height: 1512,
        frames: {
            frameWidth: 174,
            frameHeight: 126,
            numFrames: 12
        },
        sprites: {
            fish: {from:0, to:7}
        }
    });

    //create a fish sprite
    var fish = new Hilo.Sprite({
        frames: atlas.getSprite('fish'),
        x: 0,
        y: 100,
        interval: 6,
        timeBased: false,
        loop: true,
        onUpdate: function(){
            if(this.x > stage.width - this.pivotX){
                this.x = 0;
            }else{
                this.x += 3;
            }
        }
    }).addTo(stage);
}
```
- 效果演示

###Text

- 代码示例

```javascript
function init(){
    var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winWidth - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });

    //start stage ticker
    var ticker = new Hilo.Ticker(20);
    ticker.addTick(stage);
    ticker.start();

    var font = "14px arial";
    var content = "Hello World! Hilo是一款HTML5 2D游戏引擎，欢迎使用。";

    //text view
    var text = new Hilo.Text({
        font: font,
        text: content,
        lineSpacing: 0,
        width: 250,
        height: 100,
        x: 40,
        y: 50
    }).addTo(stage);

    //text wrapped in dom element
    var elem = new Hilo.DOMElement({
        element: Hilo.createElement('div', {
            innerHTML: content,
            style: {
                position: 'absolute',
                font: font
            }
        }),
        width: 250,
        height: 100,
        x: 40,
        y: 150,
    }).addTo(stage);
}
```
- 效果演示
![BitMapText](http://gtms03.alicdn.com/tps/i3/TB1AV6WHXXXXXXzapXXibZsTFXX-624-270.png)

###Tween

- 代码示例

```javascript
var boxes = [];

function init(){
    var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winHeight - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });

    //start stage ticker
    var ticker = new Hilo.Ticker(20);
    ticker.addTick(stage);
    ticker.addTick(Hilo.Tween);
    ticker.start();
    
    var total = 100;
    for(var i = 0; i < total; i++){
        var box = document.createElement('div');
        box.id = 'box' + i;
        box.className = 'box';
        gameContainer.appendChild(box);
        boxes[i] = box;
    }
    boxes.reverse();
    run()
    setInterval(run,10000)
}
function run(){
    setTimeout(runStagger, 100);
    setTimeout(runBack, 5000);
}
function runStagger(){
    Hilo.Tween.to(boxes, {y:100}, {
        duration: 2000, 
        stagger: 20, 
        ease: Hilo.Ease.Elastic.EaseIn, 
        onUpdate: onUpdate
    });

    window.tweens = Hilo.Tween._tweens.slice();
}

function runBack(){
    Hilo.Tween.to(boxes, {y:0}, {
        duration: 2000, 
        stagger: 20, 
        ease: Hilo.Ease.Elastic.EaseIn, 
        onUpdate: onUpdate
    });
    
    window.tweens = Hilo.Tween._tweens.slice();
}

function runLink(){
    var box1 = boxes[0], box2 = boxes[1];

    Hilo.Tween.to(box1, {y:100}, {
        duration: 1000,
        onUpdate: onUpdate
    }).link(Hilo.Tween.to(box2, {y:100}, {
        duration: 1000,
        delay: '+1000',
        onUpdate: onUpdate
    }));

    window.tweens = Hilo.Tween._tweens.slice();
}

function onUpdate(ratio, tween){
    tween.target.style.webkitTransform = 'translate(0,' + tween.target.y + 'px)';
}
```
- 效果演示

###WebSound

- 代码示例

```html
<div class="wrapper">
    <div>
        <a id="enableBtn" class="btn" href="javascript:void(0);">激活WebAudio，5秒后自动播放</a>
    </div>

    <div>
        <a class="sound btn" data-sound="sounds/bomb.mp3" href="javascript:void(0);">爆炸音效</a>
        <a class="sound btn" data-sound="sounds/menu.mp3" href="javascript:void(0);">背景音乐</a>
    </div>

    <div>
        <a class="sound btn" data-sound="http://g.tbcdn.cn/mtb/app-618h5/1.0.8/images/mole_die.mp3" href="javascript:void(0);">远程音效</a>
    </div>

    <div>
        <a id="pauseBtn" class="control btn" href="javascript:void(0);">暂停</a>
        <a id="resumeBtn" class="control btn" href="javascript:void(0);">恢复</a>
        <a id="stopBtn" class="control btn" href="javascript:void(0);">停止</a>
        <a id="muteBtn" data-mute="0" class="control btn" href="javascript:void(0);">静音</a>
    </div>

    <div>
        <label>音量：</label> <input id="volume" type="range" value="100">
    </div>
</div>
```

```javascript
var event = Hilo.event.POINTER_START;
    var autoPlaySound = false;
    var audio = null;

    var stage = new Hilo.Stage({
        container:document.body,
        width:1,
        height:1
    });

    var aElems = document.getElementsByTagName("a");
    var soundElems = [];
    for(var i = 0;i < aElems.length;i ++){
        if(aElems[i].className.indexOf("sound") > -1){
            soundElems.push(aElems[i]);
        }
    }

    document.getElementById("enableBtn").onclick = function(){
        Hilo.WebSound.enableAudio();
        this.className = 'btn disabled';
        autoPlaySound = true;
    };
    
    //auto play sound after 5s if `WebAudio` is enabled
    setTimeout(function(){
        if(!autoPlaySound) return;
        audio = Hilo.WebSound.getAudio({
            src: soundElems[1].getAttribute('data-sound')
        }).play();
    }, 5000);

    //play different sounds
    for(var i = 0; i < soundElems.length; i++){
        var soundElem = soundElems[i];
        soundElem.onclick = function(e){
            audio = Hilo.WebSound.getAudio({
                src: this.getAttribute('data-sound'),
                loop: false
            }).play();
        };
    }

    //control sound: pause, resume, stop, setMute, setVolume
    document.getElementById('pauseBtn').onclick = function(e){
        audio && audio.pause();
    };

    document.getElementById('resumeBtn').onclick = function(e){
        audio && audio.resume();
    };

    document.getElementById('stopBtn').onclick = function(e){
        audio && audio.stop();
    };

    document.getElementById('muteBtn').onclick = function(e){
        var muted = parseInt(this.getAttribute('data-mute')) == 0;
        this.setAttribute('data-mute', muted ? 1 : 0);
        document.getElementById('volume').value = muted ? 0 : 100;
        audio && audio.setMute(muted);
    };

    document.getElementById('volume').onchange = function(e){
        var volume = this.value * 0.01;
        audio && audio.setVolume(volume);
    };
```

- 效果演示

###碰撞检测

- 代码示例

```javascript
var winWidth = window.innerWidth || document.documentElement.clientWidth;
    var winHeight = window.innerHeight || document.documentElement.clientHeight;
    
    var gameContainer = document.getElementById("game-container");
    gameContainer.style.height = winHeight - gameContainer.offsetTop + 'px';

    //init stage
    var stage = new Hilo.Stage({
        container: gameContainer,
        width: winWidth,
        height: winHeight - gameContainer.offsetTop
    });

    //start stage ticker
    var ticker = new Hilo.Ticker(20);
    ticker.addTick(stage);
    ticker.addTick(Hilo.Tween);
    ticker.start();


    add();
    setInterval(add, 5000)
    //create a bitmap
    function add(){
        plane = new Hilo.Bitmap({
        image: 'images/ship01.png',
        rect: [0, 0, 60, 45],
        x: 75,
        y: 150
    }).addTo(stage);


        bullet = new Hilo.Bitmap({
            image: 'images/bullet.png',
            rect: [12, 12, 5, 5],
            x: 105,
            y: 0
        }).addTo(stage)
        
        bullet.tween = Hilo.Tween.to(bullet, {
            y: stage.height
        }, {
            time: 4000,
            onUpdate: function(){
                checkEnemyHit(bullet.x,bullet.y)
            },
            onComplete: function(){
                bullet.removeFromParent()
            }
        })
    }

    function checkEnemyHit(x,y){
        var target = plane
        if (x > target.x && x < target.x + 60 && y > target.y && y < target.y + 45) {
            plane.removeFromParent()
            var explosion = new Hilo.Bitmap({
                image: 'images/explosion.png',
                rect: [12, 14, 68, 74],
                x: target.x + 15,
                y: target.y,
                onUpdate: function() {
                    if (this.startTime > 40) {
                        this.removeFromParent()
                    }
                    this.startTime++
                }
            })
            stage.addChild(explosion)
            explosion.startTime = 0
        }
    }
}
```
- 效果演示


##常见的问题

1.在平时可以在chrome下调试flash模式，在URL后加上?forceFlash
2.兼容flash时：当图片地址和hilo-flash.min.js文件在不同域下，会导致图片加载不上
3.鼠标事件要取stage的左上角坐标，flash模式会取canvas的父容器坐标，要保证flash和stage坐标系一致 ，传container的直接取container坐标

- 代码示例

```html
<div id="canvas"></div>
```

```javascript
Game.stage = new Hilo.Stage({
			container:"canvas",
			width: w,
			height: h,
			scaleX: (window.devicePixelRatio > 1 ? 0.5 : 1),
			scaleY: (window.devicePixelRatio > 1 ? 0.5 : 1)
		});
```
4.当舞台canvas的样式border、margin、padding等属性更改后，需要调用此方法更新舞台渲染区域。需要调用Game.stage.updateViewport()

